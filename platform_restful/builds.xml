<?xml version="1.0" encoding="UTF-8"?>
<project name="webmodulebuilder" default="deploy" basedir=".">
	<property file="build.properties" />

	<!-- set global properties for this build -->

	<!-- 发布WEB路径 -->
	<property name="DEPLOY_PATH" value="${TOMCAT_PATH}/webapps/platform_restful" />

	<!-- 源WEB路径 -->
	<property name="WEB_PATH" value="${GIT_PATH}/platform_restful/WebContent" />

	<!-- 源platfrom的java文件路径 -->
	<property name="SCR_PATH_PLA" value="${GIT_PATH}/platform/src" />
	
	<!-- 源platfrom的java文件路径 -->
	<property name="SCR_PATH_MANAGER" value="${GIT_PATH}/platform_management/src" />

	<!-- 源platfrom的编译的jar包路径 -->
	<property name="JAR_PATH" value="${GIT_PATH}/platform_restful/WebContent/WEB-INF/lib" />

	<!-- 源java文件路径 -->
	<property name="SCR_PATH" value="${GIT_PATH}/platform_restful/src" />

	<!-- 源class文件路径 -->
	<property name="CLASS_PATH" value="${GIT_PATH}/platform_restful/WebContent/WEB-INF/classes" />
	<!-- tomcat class文件路径 -->
	<property name="JAR_PATH_TOM" value="${TOMCAT_PATH}/lib" />

	<!-- 定义classpath -->
	<path id="LIB_CLASS_PATH">
		<fileset file="${JAR_PATH}/*.jar" />
	
	</path>
	<path id="LIB_CLASS_PATH_TOM">
		<fileset file="${JAR_PATH_TOM}/*.jar" />
		<!--pathelement path="${CLASS_PATH}" -->
	</path>

	<!-- 初试化 -->
	<target name="init" description="init the Tomcat folders">
		<echo message="init the Tomcat folders..." />
		<delete dir="${DEPLOY_PATH}" />
		<delete dir="${CLASS_PATH}" />
		<mkdir dir="${DEPLOY_PATH}" />
		<mkdir dir="${DEPLOY_PATH}/WEB-INF" />
		<mkdir dir="${DEPLOY_PATH}/WEB-INF/classes" />
		<mkdir dir="${DEPLOY_PATH}/WEB-INF/lib" />
		<mkdir dir="${CLASS_PATH}" />
	</target>

	<target name="compile_pla" depends="init" description="compile the source files2">
		<echo message="compiling platform..." />

		<javac  encoding="UTF-8" srcdir="${SCR_PATH_PLA}" destdir="${CLASS_PATH}" includeantruntime="on">
			<classpath refid="LIB_CLASS_PATH" />
		</javac>
	</target>
	
	<target name="compile_management" depends="init" description="compile the source files management">
			<echo message="compiling platform_management..." />

			<javac encoding="UTF-8" srcdir="${SCR_PATH_MANAGER}" destdir="${CLASS_PATH}" includeantruntime="on">
				<classpath refid="LIB_CLASS_PATH" />
			</javac>
		</target>
	<!-- 编译类 -->
	<target name="compile" depends="init,compile_management" description="compile the source files">
		<!-- mkdir dir="${CLASS_PATH}"-->
		<echo message="compiling platform_restful..." />
		<javac  encoding="UTF-8" srcdir="${SCR_PATH}" destdir="${CLASS_PATH}" includeantruntime="on">
			<classpath refid="LIB_CLASS_PATH" />
			<classpath refid="LIB_CLASS_PATH_TOM" />
		</javac>
	</target>

	<target name="copy_properties" depends="init,compile_pla,compile">
		<echo message="copy_properties" />
		<copy todir="${WEB_PATH}/WEB-INF/classes/">
			<fileset dir="${SCR_PATH}">
				<include name="**/*.properties" />
			</fileset>
		</copy>
	</target>

	<!-- Copy发布-->
	<target name="deploy" depends="init,compile_pla,compile,copy_properties">
		<echo message="copy to Tomcat.." />
		<copy todir="${DEPLOY_PATH}">
			<fileset dir="${WEB_PATH}">
				<include name="**/*.*" />
				<exclude name="**/jsp_servlet/*.class" />
				<exclude name="**/build.xml" />
				<exclude name="**/deploy.xml" />
				<exclude name="**/build.properties" />
				<exclude name="**/servers.xml" />
				<exclude name="**/targets.xml" />
				<exclude name="**/*.war" />
			</fileset>
		</copy>
	</target>

</project>

